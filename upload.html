<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IrsanAI Upload Machine</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <style>
    body {
      background: #111;
      color: #0f0;
      font-family: monospace;
      padding: 2em;
    }
    input, button {
      padding: 1em;
      font-size: 1em;
      margin: 1em 0;
    }
    .result, canvas, img {
      margin-top: 1em;
      border: 1px solid #0f0;
      max-width: 100%;
    }
    .progress {
      height: 20px;
      width: 100%;
      background: #333;
      border-radius: 5px;
      margin-top: 10px;
    }
    .bar {
      height: 100%;
      width: 0%;
      background: #0f0;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>Brudaa Upload Terminal</h1>

  <input type="file" id="media" accept="image/*,video/*,audio/*,text/*" multiple>
  <button onclick="brudaaUpload()">Brudaa Upload</button>
  <button onclick="runYOLO()">YOLO Check</button>

  <div class="progress"><div class="bar" id="progressBar"></div></div>
  <canvas id="canvas"></canvas>
  <div id="result" class="result">Bereit...</div>

  <script>
    let uploadQueue = [];
    let model;

    // YOLO-Modell laden
    cocoSsd.load().then(m => {
      model = m;
      document.getElementById("result").textContent = "System ready. Brudaa!";
    });

    function runYOLO() {
      const files = document.getElementById('media').files;
      if (!files.length) return alert("Wähle ein Bild!");

      const img = new Image();
      const reader = new FileReader();
      reader.onload = () => {
        img.src = reader.result;
      };
      reader.readAsDataURL(files[0]);

      img.onload = async () => {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        const predictions = await model.detect(img);
        predictions.forEach(pred => {
          ctx.strokeStyle = "#0f0";
          ctx.lineWidth = 2;
          ctx.strokeRect(...pred.bbox);
          ctx.fillStyle = "#0f0";
          ctx.fillText(pred.class, pred.bbox[0], pred.bbox[1] - 5);
        });

        const hashtags = predictions.map(p => `#${p.class}`).join(" ");
        document.getElementById("result").innerHTML =
          `<strong>YOLO:</strong><br>${hashtags}`;
      };
    }

    function brudaaUpload() {
      const files = document.getElementById('media').files;
      if (!files.length) return alert("Keine Dateien gewählt!");

      for (let file of files) {
        uploadQueue.push(file);
      }

      if (navigator.onLine) {
        processQueue();
      } else {
        alert("Kein Netz – Dateien gespeichert in Warteschlange!");
      }
    }

    async function processQueue() {
      if (!uploadQueue.length) return;

      for (let i = 0; i < uploadQueue.length; i++) {
        const file = uploadQueue[i];
        const percent = Math.round(((i + 1) / uploadQueue.length) * 100);
        document.getElementById("progressBar").style.width = percent + "%";

        // Simulierter Upload
        await new Promise(r => setTimeout(r, 800));
        console.log("Upload:", file.name);

        // Optional: hier POST mit fetch() o.ä. an Backend
      }

      uploadQueue = [];
      document.getElementById("result").innerText = "Upload abgeschlossen!";
    }

    window.addEventListener("online", () => {
      if (uploadQueue.length) {
        alert("Verbindung wieder da – Upload startet...");
        processQueue();
      }
    });
  </script>
</body>
</html>